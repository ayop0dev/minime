# Minime Admin Dashboard - Next.js Source

This directory contains the **React/Next.js source code** for the Minime admin dashboard.

## Quick Start

### Development

Run the development server:

```bash
npm install
npm run dev
```

The admin dashboard will be available at `http://localhost:3000`

### Deploy to Plugin

Build and deploy to the WordPress plugin in one command:

```bash
npm run deploy
```

This runs:
1. `npm run build` - Next.js compilation with static export (generates `out/` directory)
2. `npm run copy` - Copy to `../assets/admin-app/`

The WordPress plugin will automatically serve the files from `wp-content/plugins/minime/assets/admin-app/`

## Scripts

| Script | Purpose |
|--------|---------|
| `npm run dev` | Start dev server on http://localhost:3000 |
| `npm run build` | Compile Next.js app and generate static export to `out/` |
| `npm run copy` | Copy build output to WordPress plugin folder |
| `npm run deploy` | Full pipeline: build → copy |
| `npm run clean` | Remove `.next/`, `out/`, and plugin assets |

## Project Structure

```
admin-src/
├── public/
│   └── fonts/                  # Self-hosted fonts (copied to out/ on build)
│       ├── changa-regular.woff2
│       ├── changa-medium.woff2
│       └── changa-bold.woff2
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── layout.tsx          # Root layout
│   │   ├── page.tsx            # Home page
│   │   ├── globals.css         # Global styles (imports fonts)
│   │   └── page.module.css     # Component styles
│   └── styles/
│       └── fonts.css           # Font definitions (uses /fonts/*.woff2)
├── scripts/
│   ├── copy-to-plugin.js       # Deploy script
│   └── clean.js                # Clean artifacts
├── package.json                # Dependencies & scripts
├── next.config.js              # Next.js configuration
├── tsconfig.json               # TypeScript configuration
└── .next/                      # Build cache (generated)
```

## Output Location

When you run `npm run deploy`, the compiled app is deployed to:

```
wp-content/plugins/minime/
└── assets/
    └── admin-app/              # ← WordPress serves from here (auto-generated)
        ├── index.html
        ├── fonts/              # Self-hosted fonts (auto-copied)
        │   ├── changa-regular.woff2
        │   ├── changa-medium.woff2
        │   └── changa-bold.woff2
        ├── _next/
        │   ├── static/
        │   └── server/
        └── [other assets]
```

⚠️ **Important:** Do NOT manually edit files in `assets/admin-app/` — it is auto-generated by the build process. All changes are overwritten by `npm run deploy`.

## Configuration

### next.config.js

The Next.js config is pre-configured for:
- **Static export** (`output: 'export'`) - no Node.js runtime required
- **Image optimization disabled** - uses standard `<img>` tags
- **Trailing slashes** - compatibility with static hosting
- **React strict mode** - catches development bugs

### Environment Variables

Currently, no env vars are required. WordPress config is injected via `window.MINIME_ADMIN_CONFIG` in the template.

## Self-Hosted Fonts

The admin dashboard uses self-hosted Changa fonts for zero external dependencies.

### Font Files

Font files are stored in `public/fonts/` and are automatically:
1. Bundled into the Next.js export on `npm run build`
2. Copied to `assets/admin-app/fonts/` on `npm run copy`
3. Served to WordPress from the plugin assets folder

### Font Setup

- **`src/styles/fonts.css`** - Defines @font-face rules using `/fonts/*.woff2` paths
- **`src/app/globals.css`** - Imports fonts.css and sets `font-family: 'changa'`
- **`public/fonts/`** - Source font files (read-only in deployed app)

### Adding or Updating Fonts

1. Place `.woff2` files in `public/fonts/`
2. Add @font-face rule to `src/styles/fonts.css` with matching font-weight
3. Run `npm run deploy` to build and copy to plugin

## Troubleshooting

### "Source directory does not exist" error

This means the `out/` directory wasn't created by the build. Run:

```bash
npm run deploy
```

This will automatically build and generate the `out/` directory, then copy to the plugin.

### Files not appearing in WordPress

1. Check that `assets/admin-app/` has files
2. Clear browser cache (Ctrl+Shift+Delete)
3. Verify `templates/admin-shell.php` is being used
4. Check browser console for errors

### Development server won't start

```bash
npm install
npm run dev
```

Make sure port 3000 is available, or Next.js will prompt for another port.

## Adding Dependencies

When adding npm packages:

```bash
npm install <package-name>
npm run deploy  # Rebuild and deploy
```

## Notes

- **Next.js 14 static export**: `output: 'export'` in config automatically generates `out/` on `npm run build`
- **No separate export step**: Unlike older Next.js, there's no `next export` command
- **Auto-copied fonts**: `public/fonts/` is automatically included in static export
- **Windows-friendly paths**: All scripts use `path.resolve()` instead of hardcoded paths
- **Node-based cleanup**: `npm run clean` removes artifacts without external dependencies
- **WordPress integration**: Config is injected via `window.MINIME_ADMIN_CONFIG`
- **Generated assets**: Do NOT manually edit `assets/admin-app/` — always run `npm run deploy` to update
